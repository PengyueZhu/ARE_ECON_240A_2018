---
title: "Assignment_8"
author: "Clustered Errors"
date: "3/14/2018"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(MASS)
library(broom)
library(modelr)
library(tidyverse)
```

## R Markdown

This is an R Markdown presentation. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.


```{r sim}
Sigma <-matrix(c(1, 0.7, 0.7, 1), 2)
X <-mvrnorm(n=n,c(0, 0), Sigma = Sigma)
y <- 1.2 + 0.3*X[,1]+1.1*X[,2] + rnorm(n)


sim_reg <- function(n=100, B=200) {
  Sigma <-matrix(c(1, 0.7, 0.7, 1), 2)
  X <-mvrnorm(n=n, c(0, 0), Sigma = Sigma)
  y <- 1.2 + 0.3*X[,1]+1.1*X[,2] + rnorm(n)
  df <-data_frame(y=y, X1=X[,1], X2=X[,2])
  
  ## reg
  reg <-lm(y~X1+X2, data=df)
  reg_su <-summary(reg)
  reg_co <-tidy(reg_su)
  co_X0 <- reg_co$estimate[1]
  co_X1 <- reg_co$estimate[2]
  co_X2 <- reg_co$estimate[3]
  
  beta_hat <- c(co_X0, co_X1, co_X2)
  beta_naught <- c(1.2, 0.3, 1.1) 
  
  ratio <- co_X1/co_X2
  
  ## Delta
  # R <- COMPUTE IT for the three parameters
  R <- c(0, 1.1, -0.3)
  v <-as.numeric(t(R) %*% 
        vcov(reg_su) %*%
          R)
  # W-test
  W_test <- (t(R) %*% beta_hat - t(R) %*% beta_naught) %*% 
    (t(R) %*% v %*% R)^{-1} %*% 
      (t(R) %*% beta_hat - t(R) %*% beta_naught)
  
  ## boot it:
  x_boot <- modelr::bootstrap(df, n=B) %>% 
    mutate(reg=map(strap, ~lm(y~X1+X2, data=.)),
           reg_su =map(reg, summary),
           reg_co =map(reg_su, tidy),
           ratio_b =map_dbl(reg_co, ~.$estimate[2]/.$estimate[3]),
           R =map(reg_co, COMPUTE ))),
          vcov_b =map2_dbl(reg_su, R, COMPUTE)),
          W_test_b =map2_dbl(ratio_b, vcov_b, COMPUTE centering around H0 ratio),
          W_test_b2 =map2_dbl(ratio_b, vcov_b, COMPUTE centering around estimated ratio ))
  x_boot2 <- x_boot %>% 
    summarise(boot_sd=sd(ratio_b),
              boot_sd_v =mean(vcov_b),
              boot_mean=mean(ratio_b),
              wtest_cval=COMPUTE,
              wtest2_cval=COMPUTE)
  x_boot2
  
  ## results: original Wald and va, and boot aggregates
  data_frame(co_X1=co_X1, co_X2=co_X2, ratio=ratio,W_test=W_test,v=v) %>% 
    bind_cols(x_boot2)
  }



```


## Slide with Plot

```{r pressure}
plot(pressure)
```

